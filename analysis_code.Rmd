---
title: "analysis_code"
author: "Diana_Gutierrez"
date: "8/25/2020"
output: html_document
---
####EXAMPLE CODE########

This markdown contains examples of code you can use for your analysis. There is no preset way of analyzing your data and there are decisions that need to be made depending on your data quality, characteristics and other experimental factors so you should use this code and apply it to what you need to evaluate in your especific analysis

###Exploratory code 

```{r}
hist(sample_sums(ps), main="Histogram: Read Counts", xlab="Total Reads", 
     border="blue", col="green", las=1, breaks=12)
```



###Aglomerating data 

Here we are agglomerating the counts to the Phylum-level and then renaming the ASVs to make them more descriptive. We can see that we have 10 Phyla. The ASV information (i.e. refseq and taxonomy for one of the ASVs in each Phylum) gets carried along for the ride (we can typically ignore this or you can remove these components if you prefer).


```{r}
(ps_phylum <- tax_glom(ps, "Phylum"))
taxa_names(ps_phylum)
taxa_names(ps_phylum) <- tax_table(ps_phylum)[, 2]
taxa_names(ps_phylum)
otu_table(ps_phylum)[1:5, c(1:3, 5, 7)]

```

###Subset Data

```{r}
#We can also subset taxaâ€¦
(ps_bacteroides <- subset_taxa(ps, Genus == "Bacteroides"))
tax_table(ps_bacteroides)
prune_taxa(taxa_sums(ps) > 100, ps) 
filter_taxa(ps, function(x) sum(x > 10) > (0.1*length(x)), TRUE)   

```
With the above commands we can quickly see that we have:
A total of 3 ASVs classified as Bacteroides
A total of 99 ASVs seen at least 100 times across all samples
A total of 135 taxa seen at least 10 times in at least 10% of samples
This highlights how we might use phyloseq as a tool to filter taxa prior to statistical analysis.



*###Graphic code###* 
###Alpha-Diversity 

```{r}
head(estimate_richness(ps2))
```





```{r}

(p <- plot_richness(ps2, x = "diet_group", color = "sex", measures = c("Observed", "Chao1", "Shannon")))
(ps <- plot_richness(ps, x = "diet_group", color = "sex", measures = c("Observed", "Chao1", "Shannon")))

p + labs(x = "", y = "\nAlpha Diversity Measure\n") + 
  theme_bw()



```
###Beta diversity ordination 

```{r}
ps_bray <- ordinate(ps2, "NMDS", "bray")
plot_ordination(ps, ps_bray, type="samples", color="diet_group", shape = "sex") + geom_point(size = 3) 

```





